# Step 4: エラーと実行時の振る舞い

仕上げとして、パーサーが入力全体を消費できなかった場合の例外や、メモ化キャッシュの扱いを確認します。

## 入力を最後まで消費する

`parseAllOrThrow` は「最初から最後までマッチできたか」をチェックします。失敗時には例外で原因が分かります。

- 先頭で何もマッチしない: `UnmatchedInputParseException`
- 部分的には成功したが末尾に余りがある: `ExtraCharactersParseException`

`map` 内で例外を投げるとその分岐は失敗として扱われるため、変換時のバリデーションを簡潔に書けます。

## キャッシュのオン/オフ

`ParseContext` はデフォルトでメモ化するため、バックトラッキングが多い構文でも実行時間が安定します。  
メモリ使用量を抑えたい場合や、副作用を都度実行したい場合は `parseAllOrThrow(input, useCache = false)` で無効化できます。

## デバッグの足がかり

- 小さな入力で失敗ケースを切り分け、`optional` や `zeroOrMore` が巻き戻しているかを確認します。
- 型や戻り値の形が不明なときは、IDE の KDoc とコード補完を参照すると誤りを減らせます。
- さらに詳しくは `imported/src/commonTest/kotlin/ParserTest.kt` のテストケースが実例になっています。

---

お疲れさまでした！各ステップを組み合わせて、自分のドメインに合わせたパーサーを作成してみてください。
